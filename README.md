# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

### Данные и типы данных, используемые в приложении

Карточка товара

```
export interface ICardItem {
   id: string;
   title: string;
   price: number;
   image: string;
   category: string;
   description: string;
}
```

Массив карточек товаров и функций для взаимодействия с ICardItem.

```
export interface IToDoList {
  cards: ICardItem[];
  add(card: ICardItem): void;
  remove(id: string): void;
  get(cards: ICardItem[]): void;
  getTotalPrice(prices: number[]): number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- Model - слой данных, отвечает за хранение и изменение данных,
- View - слой представления, отвечает за отображение данных на странице,
- Presenter - отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Model - Слой данных

#### Класс ICardItem

Класс, представляющий карточку товара.

Поля:

- id: string - Уникальный идентификатор карточки товара.
- title: string - Наименование товара.
- price: number - Цена товара.
- image: string - Ссылка на изображение товара.
- category: string - Категория товара.
- description: string - Описание товара.

#### Класс IToDoList

Класс, содержащий поле для массива ICardItem и набор методов для взаимодействия с ICardItem.

Поля:

- cards: ICardItem[] - Массив карточек товаров.

Методы:
- add(card: ICardItem): void - Позволяет добавлять карточку
- remove(id: string): void - Позволяет добавлять карточку
- get(cards: ICardItem[]): void - Позволяет выводить массив карточек
- getTotalPrice(prices: number[]): number - Считает общую сумму

### View - Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса

- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithConfirm

Расширяет класс Modal. Предназначен для реализации модального окна подтверждения. При открытии модального окна сохраняет полученный в параметрах обработчик, который передается для выполнения при сабмите формы.\
Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- open(handleSubmit: Function): void - расширение родительского метода, принимает обработчик, который передается при инициации события подтверждения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalBasket 
Расширяет класс Modal и представляет корзину покупок. 
Поля класса: 

- items: Map<string, number>: Хранит массив выбранных товаров в корзине. 

Методы: 
- setChecked(isChecked: boolean): void - переключатель кнопки с "В корзину" на "Удалить"
- totalPrice(prices: number[]): number: Вычисляет общую стоимость товаров в корзине. 

#### Класс ModalWithForm

Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:

- submitButton: HTMLButtonElement - Кнопка подтверждения
- \_form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы

Методы:

- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalCardPreview

Расширяет класс Modal. Предназначен для реализации модального окна с выводом карточки товара. При открытии модального окна получает данные конкретной карточки, которые нужно показать.\
Поля класса:

- cardElement: HTMLImageElement - шаблон разметки с превью-карточки

Методы:

- open(data: ICardItem): void - расширение родительского метода, принимает данные карточки товара, которые используются для заполнения атрибутов элементов модального окна.
- isChecked(): boolean - метод возвращает наличие карточки в корзине

#### Класс CardsContainer

Отвечает за отображение блока с карточками товаров на главной странице. В конструктор принимает контейнер, в котором размещаются карточки.

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

### Presenter - Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `basket:changed` - измененме данных о выбранных товарах в корзине
- `cards:changed` - выведение на страницу массива карточек с товарами
- `modalClear` - очистка введенных пользователем данных при открытии модальных окон

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `сard:open` - открытие модального окна с карточкой товара
- `add-card:submit` - событие, генерируемое при нажатии "В корзину" в форме модального окна с карточкой товара
- `remove-card:submit` - событие, генерируемое при нажатии "Удалить" в форме модального окна с карточкой товара, если товар уже был добавлен в корзину
- `basket:open` - открытие модального окна корзины с товарами
- `place-order:submit` - событие, генерируемое при нажатии "Оформить" в форме корзины с товарами
- `item-delete:submit` - событие, генерируемое при нажатии "Удалить" в форме модального окна корзины с товарами
- `order-field:input` - изменение данных в форме с данными об оплате (способ оплаты, адрес)
- `contacts-field:input` - изменение данных в форме с контактными данными (email, телефон)
- `order-field-button:submit` - событие, генерируемое при нажатии "Далее" в форме выбора способа оплаты
- `contacts-field-button:submit` - событие, генерируемое при нажатии "Оплатить" в форме с контактными данными покупателя
- `order-success:submit` - событие, генерируемое при нажатии "За новыми покупками!" в форме подтверждения заказа
